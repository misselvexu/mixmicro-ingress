spring.application.name=mixmicro-ingress-server


## server port defined, default: 7777
server.port=7777

## runtime container config properties
server.undertow.accesslog.dir=${MIXMICRO_SERVER_HOME:/tmp}/logs
server.undertow.accesslog.enabled=true
server.undertow.accesslog.pattern=common
server.undertow.accesslog.prefix=mixmicro-ingress-access.
server.undertow.accesslog.rotate=true
server.undertow.accesslog.suffix=log
server.undertow.buffer-size=1024
server.undertow.direct-buffers=true
server.undertow.io-threads=16
server.undertow.max-http-post-size=0
server.undertow.worker-threads=512

mixmicro.ingress.enabled=true
mixmicro.ingress.response.transport-service-instance-cookie=true
## zuul proxy config
mixmicro.ingress.zuul.enabled=true

zuul.host.max-total-connections=500
zuul.host.max-per-route-connections=50
zuul.sensitive-headers=Set-Cookie
zuul.add-host-header=true
zuul.add-proxy-headers=true

## semaphores for hystrix
zuul.semaphore.max-semaphores=2000

## retry config
zuul.retryable=true
# 同一实例最大重试次数，不包括首次调用。默认值为0
ribbon.MaxAutoRetries=0
# 同一个服务其他实例的最大重试次数，不包括第一次调用的实例。默认值为1
ribbon.MaxAutoRetriesNextServer=1
# 是否所有操作都允许重试。默认值为false
ribbon.OkToRetryOnAllOperations=false
# 重试的状态代码
ribbon.RetryableStatusCodes=404,502

# 超时时间配置
ribbon.ConnectTimeout=5000
ribbon.ReadTimeout=5000

ribbon.MaxTotalConnections=500
ribbon.MaxConnectionsPerHost=100

hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds=6000
# 当在配置时间窗口内达到此数量的失败后，进行短路
hystrix.command.default.circuitBreaker.requestVolumeThreshold=20
# 短路多久以后开始尝试是否恢复，默认5s）-单位ms
hystrix.command.default.circuitBreaker.sleepWindowInMilliseconds=5000
# 出错百分比阈值，当达到此阈值后，开始短路。默认50%）
hystrix.command.default.circuitBreaker.errorThresholdPercentage=50


## zuul ribbon config
feign.httpclient.enabled=false
feign.okhttp.enabled=true
ribbon.okhttp.enabled=true

feign.sentinel.enabled=true
feign.hystrix.enabled=false

## =======================================
## sentinel base config
spring.cloud.sentinel.enabled=true
spring.cloud.sentinel.eager=true
spring.cloud.sentinel.log.dir=${MIXMICRO_SERVER_HOME:/tmp}/logs
spring.cloud.sentinel.filter.url-patterns=/**

## sentinel transport config
#spring.cloud.sentinel.transport.dashboard=172.17.16.25:4444

# 网关限流
spring.cloud.sentinel.datasource.ingress-gw-flow.nacos.server-addr=${spring.cloud.nacos.config.server-addr}
spring.cloud.sentinel.datasource.ingress-gw-flow.nacos.namespace=${spring.cloud.nacos.config.namespace}
spring.cloud.sentinel.datasource.ingress-gw-flow.nacos.group-id=DEFAULT_GROUP
spring.cloud.sentinel.datasource.ingress-gw-flow.nacos.data-id=ingress-services-flow.json
spring.cloud.sentinel.datasource.ingress-gw-flow.nacos.data-type=json
spring.cloud.sentinel.datasource.ingress-gw-flow.nacos.rule-type=gw_flow

# 网关API分组
#spring.cloud.sentinel.datasource.ingress-gw-api-group.nacos.server-addr=${spring.cloud.nacos.config.server-addr}
#spring.cloud.sentinel.datasource.ingress-gw-api-group.nacos.namespace=${spring.cloud.nacos.config.namespace}
#spring.cloud.sentinel.datasource.ingress-gw-api-group.nacos.group-id=DEFAULT_GROUP
#spring.cloud.sentinel.datasource.ingress-gw-api-group.nacos.data-id=ingress-services-gw-api-flow.json
#spring.cloud.sentinel.datasource.ingress-gw-api-group.nacos.data-type=json
#spring.cloud.sentinel.datasource.ingress-gw-api-group.nacos.rule-type=gw_api_group

# 网关服务熔断降级配置
spring.cloud.sentinel.datasource.ingress-gw-degrade.nacos.server-addr=${spring.cloud.nacos.config.server-addr}
spring.cloud.sentinel.datasource.ingress-gw-degrade.nacos.namespace=${spring.cloud.nacos.config.namespace}
spring.cloud.sentinel.datasource.ingress-gw-degrade.nacos.group-id=DEFAULT_GROUP
spring.cloud.sentinel.datasource.ingress-gw-degrade.nacos.data-id=ingress-services-gw-degrade.json
spring.cloud.sentinel.datasource.ingress-gw-degrade.nacos.data-type=json
spring.cloud.sentinel.datasource.ingress-gw-degrade.nacos.rule-type=degrade

# 网关黑白名单
spring.cloud.sentinel.datasource.ingress-gw-authority.nacos.server-addr=${spring.cloud.nacos.config.server-addr}
spring.cloud.sentinel.datasource.ingress-gw-authority.nacos.namespace=${spring.cloud.nacos.config.namespace}
spring.cloud.sentinel.datasource.ingress-gw-authority.nacos.group-id=DEFAULT_GROUP
spring.cloud.sentinel.datasource.ingress-gw-authority.nacos.data-id=ingress-services-gw-authority.json
spring.cloud.sentinel.datasource.ingress-gw-authority.nacos.data-type=json
spring.cloud.sentinel.datasource.ingress-gw-authority.nacos.rule-type=authority

## =======================================
## END


## swagger
mixmicro.ingress.swagger.enabled=false
mixmicro.ingress.swagger.description=Ingress Document Reference
mixmicro.ingress.swagger.title=Api Reference
mixmicro.ingress.swagger.version=${project.version}

## logger
logging.level.com.yunlsp.framework=debug
logging.level.okhttp3=debug
logging.level.feign=debug
logging.level.org.springframework.cloud.openfeign=debug
logging.level.org.springframework.boot.web=debug
logging.level.com.yunlsp.framework.ingress=debug

server.cors.enabled=true

## management endpoints
management.metrics.tags.application=${spring.application.name}
management.endpoints.web.exposure.include=*
management.endpoints.jmx.exposure.include=*